{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "title": "Anomaly Detection Overview",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}
    },
    {
      "title": "Anomaly Score Distribution",
      "type": "histogram",
      "gridPos": {"h": 8, "w": 8, "x": 0, "y": 1},
      "targets": [
        {
          "expr": "mcp_anomaly_score_bucket",
          "legendFormat": "{{le}}"
        }
      ],
      "options": {
        "legend": {"displayMode": "list", "placement": "bottom"}
      }
    },
    {
      "title": "Anomalies Detected (Rate)",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 8, "x": 8, "y": 1},
      "targets": [
        {
          "expr": "rate(mcp_anomalies_detected_total[5m])",
          "legendFormat": "{{user}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"fillOpacity": 30}
        }
      }
    },
    {
      "title": "Detection Latency (p95)",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 1},
      "targets": [
        {
          "expr": "histogram_quantile(0.95, rate(mcp_anomaly_detection_latency_seconds_bucket[5m]))",
          "legendFormat": "p95"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "textMode": "auto"
      },
      "fieldConfig": {
        "defaults": {"unit": "s", "thresholds": {"steps": [
          {"color": "green", "value": null},
          {"color": "yellow", "value": 0.1},
          {"color": "red", "value": 0.5}
        ]}}
      }
    },
    {
      "title": "High-Risk Anomalies",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 20, "y": 1},
      "targets": [
        {
          "expr": "sum(increase(mcp_anomaly_explanations_total{risk_level=~\"HIGH|CRITICAL\"}[1h]))",
          "legendFormat": "Count"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area"
      },
      "fieldConfig": {
        "defaults": {"thresholds": {"steps": [
          {"color": "green", "value": null},
          {"color": "yellow", "value": 5},
          {"color": "red", "value": 20}
        ]}}
      }
    },
    {
      "title": "Risk Level Breakdown",
      "type": "piechart",
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 5},
      "targets": [
        {
          "expr": "sum by (risk_level) (increase(mcp_anomaly_explanations_total[1h]))",
          "legendFormat": "{{risk_level}}"
        }
      ]
    },
    {
      "title": "Anomaly Types",
      "type": "piechart",
      "gridPos": {"h": 4, "w": 4, "x": 20, "y": 5},
      "targets": [
        {
          "expr": "sum by (anomaly_type) (increase(mcp_anomaly_score_by_type_count[1h]))",
          "legendFormat": "{{anomaly_type}}"
        }
      ]
    },
    {
      "title": "Ensemble Model Performance",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 9}
    },
    {
      "title": "Model Score Comparison",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
      "targets": [
        {
          "expr": "histogram_quantile(0.5, rate(mcp_ensemble_model_scores_bucket[5m]))",
          "legendFormat": "{{model}} (median)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2}
        }
      }
    },
    {
      "title": "Feature Contributions (Heatmap)",
      "type": "heatmap",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
      "targets": [
        {
          "expr": "mcp_feature_contribution",
          "legendFormat": "{{feature}}"
        }
      ],
      "options": {
        "calculate": false,
        "yAxis": {"axisPlacement": "left"}
      }
    },
    {
      "title": "Intent Checking",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 18}
    },
    {
      "title": "Intent Cache Hit Rate",
      "type": "gauge",
      "gridPos": {"h": 6, "w": 6, "x": 0, "y": 19},
      "targets": [
        {
          "expr": "mcp_intent_cache_hit_rate",
          "legendFormat": "Hit Rate"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "min": 0, "max": 1,
          "thresholds": {"steps": [
            {"color": "red", "value": null},
            {"color": "yellow", "value": 0.5},
            {"color": "green", "value": 0.7}
          ]}
        }
      }
    },
    {
      "title": "Intent Cache Size",
      "type": "stat",
      "gridPos": {"h": 3, "w": 3, "x": 6, "y": 19},
      "targets": [
        {
          "expr": "mcp_intent_cache_size",
          "legendFormat": "Entries"
        }
      ]
    },
    {
      "title": "Semantic Matches",
      "type": "stat",
      "gridPos": {"h": 3, "w": 3, "x": 9, "y": 19},
      "targets": [
        {
          "expr": "increase(mcp_intent_cache_semantic_matches_total[1h])",
          "legendFormat": "Count"
        }
      ]
    },
    {
      "title": "Intent Confidence Distribution",
      "type": "histogram",
      "gridPos": {"h": 6, "w": 6, "x": 6, "y": 22},
      "targets": [
        {
          "expr": "mcp_intent_confidence_bucket",
          "legendFormat": "{{le}}"
        }
      ]
    },
    {
      "title": "Intent Violations",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 6, "x": 12, "y": 19},
      "targets": [
        {
          "expr": "rate(mcp_intent_violations_total[5m])",
          "legendFormat": "{{tool}}"
        }
      ]
    },
    {
      "title": "Intent Check Latency",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 6, "x": 18, "y": 19},
      "targets": [
        {
          "expr": "histogram_quantile(0.95, rate(mcp_intent_check_latency_seconds_bucket[5m]))",
          "legendFormat": "p95"
        },
        {
          "expr": "histogram_quantile(0.50, rate(mcp_intent_check_latency_seconds_bucket[5m]))",
          "legendFormat": "p50"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "s"}}
    },
    {
      "title": "Model & A/B Testing",
      "type": "row",
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 25}
    },
    {
      "title": "Active Model Info",
      "type": "text",
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 26},
      "options": {
        "mode": "markdown",
        "content": "**Version:** ${mcp_model_version_info{version}}\n\n**Training Samples:** ${mcp_model_training_samples}"
      }
    },
    {
      "title": "A/B Test Traffic Split",
      "type": "piechart",
      "gridPos": {"h": 6, "w": 6, "x": 6, "y": 26},
      "targets": [
        {
          "expr": "sum by (model_id) (increase(mcp_ab_test_selections_total[1h]))",
          "legendFormat": "{{model_id}}"
        }
      ]
    },
    {
      "title": "A/B Test Performance Comparison",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 12, "x": 12, "y": 26},
      "targets": [
        {
          "expr": "histogram_quantile(0.5, rate(mcp_ab_test_performance_bucket{metric=\"anomaly_rate\"}[5m]))",
          "legendFormat": "{{model_id}} anomaly_rate"
        }
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["mcp", "ml", "anomaly-detection"],
  "templating": {"list": []},
  "time": {"from": "now-1h", "to": "now"},
  "timepicker": {},
  "timezone": "browser",
  "title": "MCP ML Anomaly Detection",
  "uid": "mcp-ml-anomaly",
  "version": 1,
  "weekStart": ""
}
